!function(a){function b(b,c){var d='<div class="scroom-square" style="left:'+b.left+"px; top:"+b.top+"px; width:"+b.width+"px; height:"+b.height+'px;"';for(var e in b)if(b.hasOwnProperty(e)){var f=b[e];"left"==e&&(d+=' positionx="'+f+'"'),"top"==e&&(d+=' positiony="'+f+'"'),"left"!=e&&"top"!=e&&"width"!=e&&"height"!=e&&(d+=" "+e+'="'+f+'"')}d+="></div>",a(c).append(d)}function c(b,c){var d=b[0].id,e=a("#"+d).attr("style").split(" "),f=a.trim(e[1].replace("px;","")),g=a.trim(e[3].replace("px;","")),h=a.trim(e[5].replace("px;","")),i=a.trim(e[7].replace("px;",""));a.ajax({type:"POST",url:c,data:{left:f,top:g,width:h,height:i},success:function(){console.log("saved!")}})}function d(b){a("#"+b).on("scroll touchmove mousewheel",function(a){return a.preventDefault(),a.stopPropagation(),!1})}a.fn.scrollZoom=function(e){var r,s,t,u,v,w,x,y,z,f=this.attr("id"),g=a("#"+f).offset(),h=g.left,i=g.top,j="#"+f+" .scroom-map .scroom-img",k=!1,l=!1,m=!1,n=!1,o=!1,q=!1,D=a("#"+f).width(),E=a("#"+f).height();window.onload=function(a){H(a)};var F=a(j).css("background-image").replace(/url\((['"])?(.*?)\1\)/gi,"$2"),G=new Image;G.src=F,G.onload=function(){v=this.width,w=this.height},a(j).on({mousemove:function(b){"scroom-square"!=b.target.className&&a(".square-detail").remove(),l?n&&(a.fn.scrollZoom.draw(u,t,b.pageX,b.pageY,j,o,h,i,x,y),o=!1):k&&H(b),a.fn.scrollZoom.pointer(l,"area",j)},mousedown:function(b){u=b.pageX,t=b.pageY;var c=a(j).css("background-position").split(" ");if(x=c[0].slice(0,-2),y=c[1].slice(0,-2),"scroom-square"==b.target.className&&l){"undefined"!=typeof e&&"undefined"!=typeof e.deleteUrl&&(q=e.deleteUrl);var d=b.target.id;a.fn.scrollZoom.remove(d,q)}else l?(n=!0,o=!0):(k=!0,n=!1),a.fn.scrollZoom.pointer(l,"area",j)},mouseup:function(b){if(n=!1,l){if(b.pageX==u&&b.pageY==t)return!1;a("#scroom-modal").modal()}else k=!1,a("html").css("cursor","auto"),a(".scroom-square").length>0&&a(".scroom-square").each(function(c,d){if(b.pageX==u&&b.pageY==t)return!1;var e=d.id,f=d.style.left.slice(0,-2),g=d.style.top.slice(0,-2),h=parseInt(r)+parseInt(f),i=parseInt(s)+parseInt(g);a("#"+e).css({left:h+"px",top:i+"px"})})}}),a(document).on("mouseenter",".scroom-square",function(b){var c=a(this).attr("id");if("undefined"!=typeof e&&"undefined"!=typeof e.hoverData&&!l){var d='<div class="square-detail" id="'+c+'-detail">';a.each(e.hoverData,function(b,e){var f=a("#"+c).attr(e);d+='<div><span class="data-key">'+e+'</span>: <span class="data-value">'+f+"</span></div>"}),d+="</div>",a("#"+c).append(d)}});var H=function(b){d(f);var c=u-b.pageX,e=t-b.pageY,g=a(j).css("background-position").split(" "),h=g[0].slice(0,-2),i=g[1].slice(0,-2);"50%"==g[0]&&(h=-v/2,i=-w/2,a(j).css("background-position",h+"px "+i+"px"));var k=parseInt(h)+parseInt(c),l=parseInt(i)+parseInt(e);k>0&&(k=0),l>0&&(l=0);var m=parseInt(v)-parseInt(D),n=parseInt(w)-parseInt(E);k<-m&&(k=-m),l<-n&&(l=-n),a(j).css("background-position",k+"px "+l+"px"),r=parseInt(k)-parseInt(x),s=parseInt(l)-parseInt(y)};"undefined"!=typeof e&&(z=e.boxes),a(z).each(function(){b(this,j)}),a(j).bind("mousewheel",function(b){var c=a(this).css("transform").split("(");c=c[1].split(", ");var d=parseFloat(c[0]),e=parseFloat(c[3]);b.originalEvent.wheelDelta/120>0?(d+=.2,e+=.2,a(this).css("transform","scale("+d+","+e+")")):(d-=.2,e-=.2,d<1&&(d=1),e<1&&(e=1),a(this).css("transform","scale("+d+","+e+")"))}),a("#"+f+" #scroom-modal button.close").click(function(b){a(j+" .scroom-square").last().remove()}),a("#"+f+" #scroom-form").submit(function(){return"undefined"!=typeof e&&"undefined"!=typeof e.saveDataUrl&&a.ajax({type:"POST",url:e.saveDataUrl,data:a("#"+f+" #scroom-form").serialize(),success:function(){"undefined"!=typeof e&&"undefined"!=typeof e.saveCoordinateUrl&&c(a(".scroom-img .scroom-square:last-child"))}}),a("#"+f+" #scroom-modal").modal("hide"),!1}),a("#"+f+" .scroom-options .scroom-area").click(function(){var b=a(this).attr("selection");"disabled"==b?(a(this).attr("selection","enabled"),l=!0,m=!0):(a(this).attr("selection","disabled"),l=!1)})},a.fn.scrollZoom.pointer=function(b,c,d){b&&"area"==c?a(d).css("cursor","crosshair"):a(d).css("cursor","move")},a.fn.scrollZoom.draw=function(b,c,d,e,f,g,h,i,j,k){var l=d-b,m=e-c;b-=h,c-=i,g&&a(f).append('<div class="scroom-square" id="square-'+b+"-"+c+'" positionx="'+j+'" positiony="'+k+'" style="left:'+b+"px; top:"+c+"px; width:"+l+"px; height:"+m+'px;"></div>'),a(f+" .scroom-square#square-"+b+"-"+c).css({width:l+"px",height:m+"px"})},a.fn.scrollZoom.remove=function(b,c){if(a("#"+b).length>0){var d=confirm("Would you like to delete this selected area!");if(1==d)if(c){var e=a("#"+b).attr("style").split(" "),f=a.trim(e[1].replace("px;","")),g=a.trim(e[3].replace("px;","")),h=a.trim(e[5].replace("px;","")),i=a.trim(e[7].replace("px;",""));a.ajax({type:"POST",url:c,data:{left:f,top:g,width:h,height:i},success:function(){a("#"+b).remove()}})}else a("#"+b).remove()}}}(jQuery);