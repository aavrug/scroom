!function(o){function s(s,e){o(e).append('<div class="scroom-square" id="'+s.id+'" positionx="'+s.left+'" positiony="'+s.top+'" style="left:'+s.left+"px; top:"+s.top+"px; width:"+s.width+"px; height:"+s.height+'px;"></div>')}function e(s){o("#"+s).on("scroll touchmove mousewheel",function(o){return o.preventDefault(),o.stopPropagation(),!1})}o.fn.scrollZoom=function(t){var r,a,n,i,c,l,p,u,f=this.attr("id"),m=o("#"+f).offset(),d=m.left,h=m.top,g="#"+f+" .scroom-map .scroom-img",v=!1,x=!1,I=!1,w=!1,b=!1,y="",q=o("#"+f).width(),k=o("#"+f).height();window.onload=function(o){Y(o)};var Z=o(g).css("background-image").replace(/url\((['"])?(.*?)\1\)/gi,"$2"),X=new Image;X.src=Z,X.onload=function(){c=this.width,l=this.height},o(g).on({mousemove:function(s){x?w&&(o.fn.scrollZoom.draw(i,n,s.pageX,s.pageY,g,b,d,h,p,u),b=!1):v&&Y(s),o.fn.scrollZoom.pointer(x,"area",g)},mousedown:function(s){i=s.pageX,n=s.pageY;var e=o(g).css("background-position").split(" ");if(p=e[0].slice(0,-2),u=e[1].slice(0,-2),"scroom-square"==s.target.className&&x){var t=s.target.id;o.fn.scrollZoom.remove(t)}else x?(w=!0,b=!0):(v=!0,w=!1),o.fn.scrollZoom.pointer(x,"area",g)},mouseup:function(s){if(w=!1,x){if(s.pageX==i&&s.pageY==n)return!1}else v=!1,o("html").css("cursor","auto"),o(".scroom-square").length>0&&o(".scroom-square").each(function(e,t){if(s.pageX==i&&s.pageY==n)return!1;var c=t.id,l=t.style.left.slice(0,-2),p=t.style.top.slice(0,-2),u=parseInt(r)+parseInt(l),f=parseInt(a)+parseInt(p);o("#"+c).css({left:u+"px",top:f+"px"})})}});var Y=function(s){e(f);var t=i-s.pageX,m=n-s.pageY,d=o(g).css("background-position").split(" "),h=d[0].slice(0,-2),v=d[1].slice(0,-2);"50%"==d[0]&&(h=-c/2,v=-l/2,o(g).css("background-position",h+"px "+v+"px"));var x=parseInt(h)+parseInt(t),I=parseInt(v)+parseInt(m);x>0&&(x=0),I>0&&(I=0);var w=parseInt(c)-parseInt(q),b=parseInt(l)-parseInt(k);-w>x&&(x=-w),-b>I&&(I=-b),o(g).css("background-position",x+"px "+I+"px"),r=parseInt(x)-parseInt(p),a=parseInt(I)-parseInt(u)};"undefined"!=typeof t&&(y=t.boxes),o(y).each(function(){s(this,g)}),o(g).bind("mousewheel",function(s){var e=o(this).css("transform").split("(");e=e[1].split(", ");var t=parseFloat(e[0]),r=parseFloat(e[3]);s.originalEvent.wheelDelta/120>0?(t+=.2,r+=.2,o(this).css("transform","scale("+t+","+r+")")):(t-=.2,r-=.2,1>t&&(t=1),1>r&&(r=1),o(this).css("transform","scale("+t+","+r+")"))}),o("#"+f+" #scroom-modal button.close").click(function(){o(g+" .scroom-square").last().remove()}),o("#"+f+" #scroom-form").submit(function(){return o.ajax({type:"POST",url:"",data:o("#"+f+" #scroom-form").serialize(),success:function(){}}),o("#"+f+" #scroom-modal").modal("hide"),!1}),o("#"+f+" .scroom-options .scroom-area").click(function(){var s=o(this).attr("selection");"disabled"==s?(o(this).attr("selection","enabled"),x=!0,I=!0):(o(this).attr("selection","disabled"),x=!1)})},o.fn.scrollZoom.pointer=function(s,e,t){s&&"area"==e?o(t).css("cursor","crosshair"):o(t).css("cursor","move")},o.fn.scrollZoom.draw=function(s,e,t,r,a,n,i,c,l,p){var u=t-s,f=r-e;s-=i,e-=c,n&&o(a).append('<div class="scroom-square" id="square-'+s+"-"+e+'" positionx="'+l+'" positiony="'+p+'" style="left:'+s+"px; top:"+e+"px; width:"+u+"px; height:"+f+'px;"></div>'),o(a+" .scroom-square#square-"+s+"-"+e).css({width:u+"px",height:f+"px"})},o.fn.scrollZoom.remove=function(s){if(o("#"+s).length>0){var e=confirm("Would you like to delete this selected area!");1==e&&o("#"+s).remove()}}}(jQuery);