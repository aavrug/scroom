!function(a){function b(b,c){a(c).append('<div class="scroom-square" id="'+b.id+'" positionx="'+b.left+'" positiony="'+b.top+'" style="left:'+b.left+"px; top:"+b.top+"px; width:"+b.width+"px; height:"+b.height+'px;"></div>')}function c(b,c){var d=b[0].id,e=a("#"+d).attr("style").split(" "),f=a.trim(e[1].replace("px;","")),g=a.trim(e[3].replace("px;","")),h=a.trim(e[5].replace("px;","")),i=a.trim(e[7].replace("px;",""));a.ajax({type:"POST",url:c,data:{left:f,top:g,width:h,height:i},success:function(){console.log("saved!")}})}function d(b){a("#"+b).on("scroll touchmove mousewheel",function(a){return a.preventDefault(),a.stopPropagation(),!1})}a.fn.scrollZoom=function(e){var q,r,s,t,u,v,w,x,y,f=this.attr("id"),g=a("#"+f).offset(),h=g.left,i=g.top,j="#"+f+" .scroom-map .scroom-img",k=!1,l=!1,m=!1,n=!1,o=!1,B=a("#"+f).width(),C=a("#"+f).height();window.onload=function(a){F(a)};var D=a(j).css("background-image").replace(/url\((['"])?(.*?)\1\)/gi,"$2"),E=new Image;E.src=D,E.onload=function(){u=this.width,v=this.height},a(j).on({mousemove:function(b){l?n&&(a.fn.scrollZoom.draw(t,s,b.pageX,b.pageY,j,o,h,i,w,x),o=!1):k&&F(b),a.fn.scrollZoom.pointer(l,"area",j)},mousedown:function(b){t=b.pageX,s=b.pageY;var c=a(j).css("background-position").split(" ");if(w=c[0].slice(0,-2),x=c[1].slice(0,-2),"scroom-square"==b.target.className&&l){var d=b.target.id;a.fn.scrollZoom.remove(d)}else l?(n=!0,o=!0):(k=!0,n=!1),a.fn.scrollZoom.pointer(l,"area",j)},mouseup:function(b){if(n=!1,l){if(b.pageX==t&&b.pageY==s)return!1;a("#scroom-modal").modal()}else k=!1,a("html").css("cursor","auto"),a(".scroom-square").length>0&&a(".scroom-square").each(function(c,d){if(b.pageX==t&&b.pageY==s)return!1;var e=d.id,f=d.style.left.slice(0,-2),g=d.style.top.slice(0,-2),h=parseInt(q)+parseInt(f),i=parseInt(r)+parseInt(g);a("#"+e).css({left:h+"px",top:i+"px"})})}});var F=function(b){d(f);var c=t-b.pageX,e=s-b.pageY,g=a(j).css("background-position").split(" "),h=g[0].slice(0,-2),i=g[1].slice(0,-2);"50%"==g[0]&&(h=-u/2,i=-v/2,a(j).css("background-position",h+"px "+i+"px"));var k=parseInt(h)+parseInt(c),l=parseInt(i)+parseInt(e);k>0&&(k=0),l>0&&(l=0);var m=parseInt(u)-parseInt(B),n=parseInt(v)-parseInt(C);k<-m&&(k=-m),l<-n&&(l=-n),a(j).css("background-position",k+"px "+l+"px"),q=parseInt(k)-parseInt(w),r=parseInt(l)-parseInt(x)};"undefined"!=typeof e&&(y=e.boxes),a(y).each(function(){b(this,j)}),a(j).bind("mousewheel",function(b){var c=a(this).css("transform").split("(");c=c[1].split(", ");var d=parseFloat(c[0]),e=parseFloat(c[3]);b.originalEvent.wheelDelta/120>0?(d+=.2,e+=.2,a(this).css("transform","scale("+d+","+e+")")):(d-=.2,e-=.2,d<1&&(d=1),e<1&&(e=1),a(this).css("transform","scale("+d+","+e+")"))}),a("#"+f+" #scroom-modal button.close").click(function(b){a(j+" .scroom-square").last().remove()}),a("#"+f+" #scroom-form").submit(function(){return"undefined"!=typeof e&&"undefined"!=typeof e.saveDataUrl&&a.ajax({type:"POST",url:e.saveDataUrl,data:a("#"+f+" #scroom-form").serialize(),success:function(){"undefined"!=typeof e&&"undefined"!=typeof e.saveCoordinateUrl&&c(a(".scroom-img .scroom-square:last-child"))}}),a("#"+f+" #scroom-modal").modal("hide"),!1}),a("#"+f+" .scroom-options .scroom-area").click(function(){var b=a(this).attr("selection");"disabled"==b?(a(this).attr("selection","enabled"),l=!0,m=!0):(a(this).attr("selection","disabled"),l=!1)})},a.fn.scrollZoom.pointer=function(b,c,d){b&&"area"==c?a(d).css("cursor","crosshair"):a(d).css("cursor","move")},a.fn.scrollZoom.draw=function(b,c,d,e,f,g,h,i,j,k){var l=d-b,m=e-c;b-=h,c-=i,g&&a(f).append('<div class="scroom-square" id="square-'+b+"-"+c+'" positionx="'+j+'" positiony="'+k+'" style="left:'+b+"px; top:"+c+"px; width:"+l+"px; height:"+m+'px;"></div>'),a(f+" .scroom-square#square-"+b+"-"+c).css({width:l+"px",height:m+"px"})},a.fn.scrollZoom.remove=function(b){if(a("#"+b).length>0){var c=confirm("Would you like to delete this selected area!");1==c&&a("#"+b).remove()}}}(jQuery);